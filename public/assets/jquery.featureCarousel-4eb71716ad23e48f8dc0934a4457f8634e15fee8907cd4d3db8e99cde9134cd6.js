/*!
 * Feature Carousel, Version 1.3
 * http://www.bkosolutions.com
 *
 * Copyright 2011 Brian Osborne
 * Licensed under GPL version 3
 * brian@bkosborne.com
 *
 * http://www.gnu.org/licenses/gpl.txt
 */
!function(r){r.fn.featureCarousel=function(e){if(this.length>1)return this.each(function(){r(this).featureCarousel(e)}),this;e=r.extend({},r.fn.featureCarousel.defaults,e||{});var t={currentCenterNum:e.startingFeature,containerWidth:0,containerHeight:0,largeFeatureWidth:0,largeFeatureHeight:0,smallFeatureWidth:0,smallFeatureHeight:0,totalFeatureCount:r(this).children("div").length,currentlyMoving:!1,featuresContainer:r(this),featuresArray:[],containerIDTag:"#"+r(this).attr("id"),timeoutVar:null,rotationsRemaining:0,itemsToAnimate:0,borderWidth:0},n=function(n){if(1==e.preload){var v=t.featuresContainer.find("img"),i=0,a=v.length;v.each(function(e,t){var v=new Image;r(v).bind("load error",function(){i++,i==a&&n()}),v.src=t.src})}else n()},v=function(r){return t.featuresArray[r-1]},i=function(r){return r-1==0?t.totalFeatureCount:r-1},a=function(r){return r+1>t.totalFeatureCount?1:r+1},o=function(){t.containerWidth=t.featuresContainer.width(),t.containerHeight=t.featuresContainer.height();var n=r(t.containerIDTag).find(".carousel-image:first");e.largeFeatureWidth>1?t.largeFeatureWidth=e.largeFeatureWidth:e.largeFeatureWidth>0&&e.largeFeatureWidth<1?t.largeFeatureWidth=n.width()*e.largeFeatureWidth:t.largeFeatureWidth=n.outerWidth(),e.largeFeatureHeight>1?t.largeFeatureHeight=e.largeFeatureHeight:e.largeFeatureHeight>0&&e.largeFeatureHeight<1?t.largeFeatureHeight=n.height()*e.largeFeatureHeight:t.largeFeatureHeight=n.outerHeight(),e.smallFeatureWidth>1?t.smallFeatureWidth=e.smallFeatureWidth:e.smallFeatureWidth>0&&e.smallFeatureWidth<1?t.smallFeatureWidth=n.width()*e.smallFeatureWidth:t.smallFeatureWidth=n.outerWidth()/2,e.smallFeatureHeight>1?t.smallFeatureHeight=e.smallFeatureHeight:e.smallFeatureHeight>0&&e.smallFeatureHeight<1?t.smallFeatureHeight=n.height()*e.smallFeatureHeight:t.smallFeatureHeight=n.outerHeight()/2},s=function(){e.displayCutoff>0&&e.displayCutoff<t.totalFeatureCount&&(t.totalFeatureCount=e.displayCutoff),t.featuresContainer.find(".carousel-feature").each(function(e){e<t.totalFeatureCount&&(t.featuresArray[e]=r(this))}),"medium"!=t.featuresContainer.find(".carousel-feature").first().css("borderLeftWidth")&&(t.borderWidth=2*parseInt(t.featuresContainer.find(".carousel-feature").first().css("borderLeftWidth"))),t.featuresContainer.find(".carousel-feature").each(function(){r(this).css({left:t.containerWidth/2-t.smallFeatureWidth/2-t.borderWidth/2,width:t.smallFeatureWidth,height:t.smallFeatureHeight,top:e.smallFeatureOffset+e.topPadding,opacity:1})}).find(".carousel-image").css({width:t.smallFeatureWidth}),e.captionBelow&&t.featuresContainer.find(".carousel-caption").css("position","relative"),t.totalFeatureCount<4?t.itemsToAnimate=t.totalFeatureCount:t.itemsToAnimate=4,t.featuresContainer.find(".carousel-caption").hide()},d=function(){r.each(t.featuresArray,function(e){r(this).data("setPosition",e+1)});var n=i(e.startingFeature);t.currentCenterNum=n;var a=v(n);a.data("position",1);var o=a.prevAll();o.each(function(e){r(this).data("position",t.totalFeatureCount-e)});var s=a.nextAll();s.each(function(e){void 0!=r(this).data("setPosition")&&r(this).data("position",e+2)}),"caption"==e.counterStyle&&r.each(t.featuresArray,function(){var e=i(r(this).data("position")),n=r("<span></span>");n.addClass("numberTag"),n.html("("+e+" of "+t.totalFeatureCount+") "),r(this).find(".carousel-caption p").prepend(n)})},l=function(){if(e.trackerIndividual){var n=r("<ul></ul>");n.addClass("tracker-individual-container");for(var v=0;v<t.totalFeatureCount;v++){var i=v+1,a=r("<div>"+i+"</div>");a.addClass("tracker-individual-blip"),a.css("cursor","pointer"),a.attr("id","tracker-"+(v+1));var o=r("<li></li>");o.append(a),o.css("float","left"),o.css("list-style-type","none"),n.append(o)}r(t.containerIDTag).append(n),n.hide().show()}if(e.trackerSummation){var s=r("<div></div>");s.addClass("tracker-summation-container");var d=r("<span></span>").addClass("tracker-summation-current").text(e.startingFeature),l=r("<span></span>").addClass("tracker-summation-total").text(t.totalFeatureCount),u=r("<span></span>").addClass("tracker-summation-middle").text(" of ");s.append(d).append(u).append(l),r(t.containerIDTag).append(s)}},u=function(r,n){if(e.trackerIndividual){var v=t.featuresContainer.find(".tracker-individual-container"),i=v.find("#tracker-"+r),a=v.find("#tracker-"+n);i.removeClass("tracker-individual-blip-selected"),a.addClass("tracker-individual-blip-selected")}if(e.trackerSummation){var v=t.featuresContainer.find(".tracker-summation-container");v.find(".tracker-summation-current").text(n)}},c=function(r){if(clearTimeout(t.timeoutVar),!r&&0!=e.autoPlay){var n=Math.abs(e.autoPlay)<e.carouselSpeed?e.carouselSpeed:Math.abs(e.autoPlay);t.timeoutVar=setTimeout(function(){e.autoPlay>0?h(!0,1):h(!1,1)},n)}},f=function(e){r.each(t.featuresArray,function(){var t;t=0==e?a(r(this).data().position):i(r(this).data().position),r(this).data("position",t)})},m=function(r,n){var v,o,s,d,l,m,h,x=r.data("position");h=1==n?i(x):a(x),1==x&&e.leavingCenter(r),1==h?(v=t.largeFeatureWidth,o=t.largeFeatureHeight,s=e.topPadding,l=r.css("z-index"),d=t.containerWidth/2-t.largeFeatureWidth/2-t.borderWidth/2,m=1):(v=t.smallFeatureWidth,o=t.smallFeatureHeight,s=e.smallFeatureOffset+e.topPadding,l=1,m=1,h==t.totalFeatureCount?d=e.sidePadding:2==h?d=t.containerWidth-t.smallFeatureWidth-e.sidePadding-t.borderWidth:(d=t.containerWidth/2-t.smallFeatureWidth/2-t.borderWidth/2,m=0)),1==x&&r.find(".carousel-caption").hide(),r.animate({width:v,height:o,top:s,left:d,opacity:m},e.carouselSpeed,e.animationEasing,function(){if(1==h&&(e.captionBelow&&r.css("height","auto"),r.find(".carousel-caption").fadeTo("fast",1),e.movedToCenter(r)),t.rotationsRemaining=t.rotationsRemaining-1,r.css("z-index",l),(e.trackerIndividual||e.trackerSummation)&&1==h){var v,o=t.featuresContainer.find(".carousel-feature").index(r)+1;v=0==n?a(o):i(o),u(v,o)}var s=t.rotationsRemaining/t.itemsToAnimate;s%1==0&&(t.currentlyMoving=!1,f(n),t.rotationsRemaining>0&&p(n)),c(!1)}).find(".carousel-image").animate({width:v,height:o},e.carouselSpeed,e.animationEasing).end()},p=function(r){t.currentlyMoving=!0;var e,n,o,s;1==r?(e=v(a(t.currentCenterNum)),n=v(t.currentCenterNum),o=v(a(a(t.currentCenterNum))),s=v(i(t.currentCenterNum)),t.currentCenterNum=a(t.currentCenterNum)):(e=v(i(t.currentCenterNum)),n=v(i(i(t.currentCenterNum))),o=v(t.currentCenterNum),s=v(a(t.currentCenterNum)),t.currentCenterNum=i(t.currentCenterNum)),r?n.css("z-index",3):o.css("z-index",3),e.css("z-index",4),m(n,r),m(e,r),m(o,r),t.totalFeatureCount>3&&m(s,r)},h=function(r,e){if(0==t.currentlyMoving){var n=e*t.itemsToAnimate;t.rotationsRemaining=n,p(r)}},x=function(r,e){var t,n=1,v=1;for(t=r;(t=i(t))!=e;)n++;for(t=r;(t=a(t))!=e;)v++;return v>n?-1*n:v};return r(e.leftButtonTag).live("click",function(){h(!1,1)}),r(e.rightButtonTag).live("click",function(){h(!0,1)}),t.featuresContainer.find(".carousel-feature").click(function(){var e=r(this).data("position");2==e?h(!0,1):e==t.totalFeatureCount&&h(!1,1)}).mouseover(function(){if(0==t.currentlyMoving){var n=r(this).data("position");(2==n||n==t.totalFeatureCount)&&r(this).css("opacity",1)}e.pauseOnHover&&c(!0),e.stopOnHover&&(e.autoPlay=0)}).mouseout(function(){if(0==t.currentlyMoving){var n=r(this).data("position");(2==n||n==t.totalFeatureCount)&&r(this).css("opacity",1)}e.pauseOnHover&&c(!1)}),r("a",t.containerIDTag).live("click",function(n){var v=r(this).parentsUntil(t.containerIDTag);v.each(function(){var v=r(this).data("position");if(void 0!=v){if(1!=v)return v==t.totalFeatureCount?h(!1,1):2==v&&h(!0,1),n.preventDefault(),!1;e.clickedCenter(r(this))}})}),r(".tracker-individual-blip",t.containerIDTag).live("click",function(){var e=r(this).attr("id").substring(8),n=t.featuresContainer.find(".carousel-feature").eq(e-1).data("position"),v=t.currentCenterNum;if(e!=v){var i=x(1,n);0>i?h(!1,-1*i):h(!0,i)}}),this.initialize=function(){return n(function(){o(),s(),d(),l(),h(!0,1)}),this},this.next=function(){h(!0,1)},this.prev=function(){h(!1,1)},this.pause=function(){c(!0)},this.start=function(){c(!1)},this.initialize()},r.fn.featureCarousel.defaults={largeFeatureWidth:0,largeFeatureHeight:0,smallFeatureWidth:.5,smallFeatureHeight:.5,topPadding:20,sidePadding:50,smallFeatureOffset:50,startingFeature:1,carouselSpeed:1e3,autoPlay:4e3,pauseOnHover:!0,stopOnHover:!1,trackerIndividual:!0,trackerSummation:!0,preload:!0,displayCutoff:0,animationEasing:"swing",leftButtonTag:"#carousel-left",rightButtonTag:"#carousel-right",captionBelow:!1,movedToCenter:r.noop,leavingCenter:r.noop,clickedCenter:r.noop}}(jQuery);