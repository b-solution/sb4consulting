/*!
 * Feature Carousel, Version 1.3
 * http://www.bkosolutions.com
 *
 * Copyright 2011 Brian Osborne
 * Licensed under GPL version 3
 * brian@bkosborne.com
 *
 * http://www.gnu.org/licenses/gpl.txt
 */
!function(e){e.fn.featureCarousel=function(t){if(this.length>1)return this.each(function(){e(this).featureCarousel(t)}),this;t=e.extend({},e.fn.featureCarousel.defaults,t||{});var r={currentCenterNum:t.startingFeature,containerWidth:0,containerHeight:0,largeFeatureWidth:0,largeFeatureHeight:0,smallFeatureWidth:0,smallFeatureHeight:0,totalFeatureCount:e(this).children("div").length,currentlyMoving:!1,featuresContainer:e(this),featuresArray:[],containerIDTag:"#"+e(this).attr("id"),timeoutVar:null,rotationsRemaining:0,itemsToAnimate:0,borderWidth:0},n=function(n){if(1==t.preload){var i=r.featuresContainer.find("img"),o=0,a=i.length;i.each(function(t,r){var i=new Image;e(i).bind("load error",function(){o++,o==a&&n()}),i.src=r.src})}else n()},i=function(e){return r.featuresArray[e-1]},o=function(e){return e-1==0?r.totalFeatureCount:e-1},a=function(e){return e+1>r.totalFeatureCount?1:e+1},s=function(){r.containerWidth=r.featuresContainer.width(),r.containerHeight=r.featuresContainer.height();var n=e(r.containerIDTag).find(".carousel-image:first");t.largeFeatureWidth>1?r.largeFeatureWidth=t.largeFeatureWidth:t.largeFeatureWidth>0&&t.largeFeatureWidth<1?r.largeFeatureWidth=n.width()*t.largeFeatureWidth:r.largeFeatureWidth=n.outerWidth(),t.largeFeatureHeight>1?r.largeFeatureHeight=t.largeFeatureHeight:t.largeFeatureHeight>0&&t.largeFeatureHeight<1?r.largeFeatureHeight=n.height()*t.largeFeatureHeight:r.largeFeatureHeight=n.outerHeight(),t.smallFeatureWidth>1?r.smallFeatureWidth=t.smallFeatureWidth:t.smallFeatureWidth>0&&t.smallFeatureWidth<1?r.smallFeatureWidth=n.width()*t.smallFeatureWidth:r.smallFeatureWidth=n.outerWidth()/2,t.smallFeatureHeight>1?r.smallFeatureHeight=t.smallFeatureHeight:t.smallFeatureHeight>0&&t.smallFeatureHeight<1?r.smallFeatureHeight=n.height()*t.smallFeatureHeight:r.smallFeatureHeight=n.outerHeight()/2},l=function(){t.displayCutoff>0&&t.displayCutoff<r.totalFeatureCount&&(r.totalFeatureCount=t.displayCutoff),r.featuresContainer.find(".carousel-feature").each(function(t){t<r.totalFeatureCount&&(r.featuresArray[t]=e(this))}),"medium"!=r.featuresContainer.find(".carousel-feature").first().css("borderLeftWidth")&&(r.borderWidth=2*parseInt(r.featuresContainer.find(".carousel-feature").first().css("borderLeftWidth"))),r.featuresContainer.find(".carousel-feature").each(function(){e(this).css({left:r.containerWidth/2-r.smallFeatureWidth/2-r.borderWidth/2,width:r.smallFeatureWidth,height:r.smallFeatureHeight,top:t.smallFeatureOffset+t.topPadding,opacity:1})}).find(".carousel-image").css({width:r.smallFeatureWidth}),t.captionBelow&&r.featuresContainer.find(".carousel-caption").css("position","relative"),r.totalFeatureCount<4?r.itemsToAnimate=r.totalFeatureCount:r.itemsToAnimate=4,r.featuresContainer.find(".carousel-caption").hide()},d=function(){e.each(r.featuresArray,function(t){e(this).data("setPosition",t+1)});var n=o(t.startingFeature);r.currentCenterNum=n;var a=i(n);a.data("position",1);var s=a.prevAll();s.each(function(t){e(this).data("position",r.totalFeatureCount-t)});var l=a.nextAll();l.each(function(t){void 0!=e(this).data("setPosition")&&e(this).data("position",t+2)}),"caption"==t.counterStyle&&e.each(r.featuresArray,function(){var t=o(e(this).data("position")),n=e("<span></span>");n.addClass("numberTag"),n.html("("+t+" of "+r.totalFeatureCount+") "),e(this).find(".carousel-caption p").prepend(n)})},c=function(){if(t.trackerIndividual){var n=e("<ul></ul>");n.addClass("tracker-individual-container");for(var i=0;i<r.totalFeatureCount;i++){var o=i+1,a=e("<div>"+o+"</div>");a.addClass("tracker-individual-blip"),a.css("cursor","pointer"),a.attr("id","tracker-"+(i+1));var s=e("<li></li>");s.append(a),s.css("float","left"),s.css("list-style-type","none"),n.append(s)}e(r.containerIDTag).append(n),n.hide().show()}if(t.trackerSummation){var l=e("<div></div>");l.addClass("tracker-summation-container");var d=e("<span></span>").addClass("tracker-summation-current").text(t.startingFeature),c=e("<span></span>").addClass("tracker-summation-total").text(r.totalFeatureCount),u=e("<span></span>").addClass("tracker-summation-middle").text(" of ");l.append(d).append(u).append(c),e(r.containerIDTag).append(l)}},u=function(e,n){if(t.trackerIndividual){var i=r.featuresContainer.find(".tracker-individual-container"),o=i.find("#tracker-"+e),a=i.find("#tracker-"+n);o.removeClass("tracker-individual-blip-selected"),a.addClass("tracker-individual-blip-selected")}if(t.trackerSummation){var i=r.featuresContainer.find(".tracker-summation-container");i.find(".tracker-summation-current").text(n)}},v=function(e){if(clearTimeout(r.timeoutVar),!e&&0!=t.autoPlay){var n=Math.abs(t.autoPlay)<t.carouselSpeed?t.carouselSpeed:Math.abs(t.autoPlay);r.timeoutVar=setTimeout(function(){t.autoPlay>0?p(!0,1):p(!1,1)},n)}},f=function(t){e.each(r.featuresArray,function(){var r;r=0==t?a(e(this).data().position):o(e(this).data().position),e(this).data("position",r)})},h=function(e,n){var i,s,l,d,c,h,p,g=e.data("position");p=1==n?o(g):a(g),1==g&&t.leavingCenter(e),1==p?(i=r.largeFeatureWidth,s=r.largeFeatureHeight,l=t.topPadding,c=e.css("z-index"),d=r.containerWidth/2-r.largeFeatureWidth/2-r.borderWidth/2,h=1):(i=r.smallFeatureWidth,s=r.smallFeatureHeight,l=t.smallFeatureOffset+t.topPadding,c=1,h=1,p==r.totalFeatureCount?d=t.sidePadding:2==p?d=r.containerWidth-r.smallFeatureWidth-t.sidePadding-r.borderWidth:(d=r.containerWidth/2-r.smallFeatureWidth/2-r.borderWidth/2,h=0)),1==g&&e.find(".carousel-caption").hide(),e.animate({width:i,height:s,top:l,left:d,opacity:h},t.carouselSpeed,t.animationEasing,function(){if(1==p&&(t.captionBelow&&e.css("height","auto"),e.find(".carousel-caption").fadeTo("fast",1),t.movedToCenter(e)),r.rotationsRemaining=r.rotationsRemaining-1,e.css("z-index",c),(t.trackerIndividual||t.trackerSummation)&&1==p){var i,s=r.featuresContainer.find(".carousel-feature").index(e)+1;i=0==n?a(s):o(s),u(i,s)}var l=r.rotationsRemaining/r.itemsToAnimate;l%1==0&&(r.currentlyMoving=!1,f(n),r.rotationsRemaining>0&&m(n)),v(!1)}).find(".carousel-image").animate({width:i,height:s},t.carouselSpeed,t.animationEasing).end()},m=function(e){r.currentlyMoving=!0;var t,n,s,l;1==e?(t=i(a(r.currentCenterNum)),n=i(r.currentCenterNum),s=i(a(a(r.currentCenterNum))),l=i(o(r.currentCenterNum)),r.currentCenterNum=a(r.currentCenterNum)):(t=i(o(r.currentCenterNum)),n=i(o(o(r.currentCenterNum))),s=i(r.currentCenterNum),l=i(a(r.currentCenterNum)),r.currentCenterNum=o(r.currentCenterNum)),e?n.css("z-index",3):s.css("z-index",3),t.css("z-index",4),h(n,e),h(t,e),h(s,e),r.totalFeatureCount>3&&h(l,e)},p=function(e,t){if(0==r.currentlyMoving){var n=t*r.itemsToAnimate;r.rotationsRemaining=n,m(e)}},g=function(e,t){var r,n=1,i=1;for(r=e;(r=o(r))!=t;)n++;for(r=e;(r=a(r))!=t;)i++;return i>n?-1*n:i};return e(t.leftButtonTag).live("click",function(){p(!1,1)}),e(t.rightButtonTag).live("click",function(){p(!0,1)}),r.featuresContainer.find(".carousel-feature").click(function(){var t=e(this).data("position");2==t?p(!0,1):t==r.totalFeatureCount&&p(!1,1)}).mouseover(function(){if(0==r.currentlyMoving){var n=e(this).data("position");(2==n||n==r.totalFeatureCount)&&e(this).css("opacity",1)}t.pauseOnHover&&v(!0),t.stopOnHover&&(t.autoPlay=0)}).mouseout(function(){if(0==r.currentlyMoving){var n=e(this).data("position");(2==n||n==r.totalFeatureCount)&&e(this).css("opacity",1)}t.pauseOnHover&&v(!1)}),e("a",r.containerIDTag).live("click",function(n){var i=e(this).parentsUntil(r.containerIDTag);i.each(function(){var i=e(this).data("position");if(void 0!=i){if(1!=i)return i==r.totalFeatureCount?p(!1,1):2==i&&p(!0,1),n.preventDefault(),!1;t.clickedCenter(e(this))}})}),e(".tracker-individual-blip",r.containerIDTag).live("click",function(){var t=e(this).attr("id").substring(8),n=r.featuresContainer.find(".carousel-feature").eq(t-1).data("position"),i=r.currentCenterNum;if(t!=i){var o=g(1,n);0>o?p(!1,-1*o):p(!0,o)}}),this.initialize=function(){return n(function(){s(),l(),d(),c(),p(!0,1)}),this},this.next=function(){p(!0,1)},this.prev=function(){p(!1,1)},this.pause=function(){v(!0)},this.start=function(){v(!1)},this.initialize()},e.fn.featureCarousel.defaults={largeFeatureWidth:0,largeFeatureHeight:0,smallFeatureWidth:.5,smallFeatureHeight:.5,topPadding:20,sidePadding:50,smallFeatureOffset:50,startingFeature:1,carouselSpeed:1e3,autoPlay:4e3,pauseOnHover:!0,stopOnHover:!1,trackerIndividual:!0,trackerSummation:!0,preload:!0,displayCutoff:0,animationEasing:"swing",leftButtonTag:"#carousel-left",rightButtonTag:"#carousel-right",captionBelow:!1,movedToCenter:e.noop,leavingCenter:e.noop,clickedCenter:e.noop}}(jQuery);